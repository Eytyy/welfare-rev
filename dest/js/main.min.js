"use strict";var CORE=function(){var e={};return{register:function(t,a){e[t]={create:a,instance:null}},registerEvent:function(t,a){this.is_obj(t)&&a?e[a]?e[a].events=t:console.log("there is an issue"):console.log("there is an issue 2")},triggerEvent:function(t){var a=void 0;Object.keys(e).forEach(function(i){e.hasOwnProperty(i)&&(a=e[i],a.events&&a.events[t.type]&&a.events[t.type](t.data))})},start:function(t){var a=e[t];a&&(a.instance=a.create(SHELL.create(this,t)),a.instance.init())},startAll:function(){var t=this;Object.keys(e).forEach(function(a){e.hasOwnProperty(a)&&t.start(a)})},AJAX:{get:function(e){console.log("https://elasticbeanstalk-us-west-2-759804563210.s3.amazonaws.com/welfare-rev/"+e);var t=new Promise(function(t,a){var i=new XMLHttpRequest;i.open("GET","https://elasticbeanstalk-us-west-2-759804563210.s3.amazonaws.com/welfare-rev/"+e),i.onload=function(){200===i.status?t(i.response):a(Error(i.statusText))},i.onerror=function(){a(Error("Network Error"))},i.send(null)});return t.then(function(e){var t=JSON.parse(e);return t}).catch(function(e){console.log(e)})}},DOM:{query:function(e){return document.querySelector(e)},queryAll:function(e){return document.querySelectorAll(e)},appendTemplate:function(e,t){t.insertAdjacentHTML("beforeend",e)},createElement:function(e,t){var a=document.createElement(e);return t.class&&t.class.forEach(function(e){a.classList.add(e)}),a}},getUrlHash:function(){var e=window.location.hash.substr(1)||"/";return e},is_arr:function(e){return Array.isArray(e)},is_obj:function(e){return"[object Object]"===Object.prototype.toString.call(e)}}}(),MAIN={init:function(){CORE.register("overlay",OVERLAY),CORE.register("messages",MESSAGES),CORE.register("info",INFO),CORE.register("about",ABOUT),CORE.register("nav",NAV),CORE.register("map",MAP),CORE.register("welfare",WELFARE),CORE.startAll(),window.onpopstate=function(){var e=CORE.getUrlHash();CORE.triggerEvent({type:"session-state-pop",data:e})}}};window.onload=function(){MAIN.init()};var mapStyles=[{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#262624"},{lightness:20}]},{featureType:"landscape",elementType:"labels",stylers:[{hue:"#ff0000"}]},{featureType:"landscape",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"labels.icon",stylers:[{color:"#ff0000"}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}],SHELL={create:function(e,t){return{await:function(){},get:function(t){return e.AJAX.get(t)},post:function(){},getHash:function(){return e.getUrlHash()},notify:function(t){e.is_obj(t)&&t.type&&e.triggerEvent(t)},listen:function(a){e.is_obj(a)&&e.registerEvent(a,t)},createElement:function(t,a){return e.DOM.createElement(t,a)},find:function(t){return e.DOM.query(t)},findAll:function(t){return e.DOM.queryAll(t)},injectTemplateText:function(t,a){e.DOM.appendTemplate(t,a)}}}},ABOUT=function(e){var t={},a={active:!1,currentAbout:null},i="data/about.json",n="";return{init:function(){t.$container=e.find("#about"),t.$title=e.find(".about-title"),t.$desc=e.find(".about-desc"),t.$toggleBtn=e.find(".map-about__grabber"),this.onAboutClicked=this.onAboutClicked.bind(this),t.$toggleBtn.addEventListener("click",this.closeAbout),e.listen({"about-clicked":this.onAboutClicked})},fetchData:function(){return e.get(i).then(function(e){return e}).catch(function(e){return console.log(e),""})},closeAbout:function(){a.active=!a.active,t.$container.classList.remove("js-active")},openAbout:function(){a.active=!a.active,t.$container.classList.add("js-active")},toggleAbout:function(e){a.active&&a.currentAbout===e?this.closeAbout():a.active||this.openAbout()},updateAbout:function(e){if(a.currentAbout!==e){var i=n[e];t.$title.innerHTML=i.title,t.$desc.innerHTML=i.desc}this.toggleAbout(e),a.currentAbout=e},onAboutClicked:function(e){var t=this;return""!==n?(this.updateAbout(e),!0):(this.fetchData().then(function(a){n=a,t.updateAbout(e)}).catch(function(e){console.log(e)}),!0)}}},INFO=function(e){var t=!1,a={},i={projects:"map-info-projects.tpl.hbs",buildings:"map-info-buildings.tpl.hbs",housing:"map-info-housing.tpl.hbs"},n={projects:{},buildings:{},housing:{}};return{init:function(){a.$container=e.find("#info"),this.updateProject=this.updateProject.bind(this),this.hideInfoWindow=this.hideInfoWindow.bind(this),this.resetInfo=this.resetInfo.bind(this),this.setupInfoWindow(),e.find(".map-info__grabber").addEventListener("click",this.toggleInfoExpand),e.find(".back2map-btn").addEventListener("click",this.onBack2mapClick),e.listen({"update-project":this.updateProject,"layer-updated":this.hideInfoWindow,"category-closed":this.hideInfoWindow,"reset-map":this.resetInfo})},onBack2mapClick:function(){e.notify({type:"back2map",data:""})},showInfoWindow:function(){a.$info.classList.add("js-view-mode")},hideInfoWindow:function(e){e.fromMap||a.$info.classList.remove("js-view-mode")},toggleInfoExpand:function(){a.$info.classList.contains("js-infoExpanded")?a.$info.classList.remove("js-infoExpanded"):a.$info.classList.add("js-infoExpanded")},resetInfo:function(){a.$info.classList.remove("js-infoExpanded")},updateInfoWindow:function(r){function o(n){var o=i[r.activeLayer];Handlebars.registerHelper({or:function(e,t){var a=e||t;return a},and:function(e,t){var a=e&&t;return a},eq:function(e,t){var a=e===t;return a},ne:function(e,t){var a=e!==t;return a},formatCurr:function(e){var t=e?e.toString().split("."):"";return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t},formatFileName:function(e){var t=e.match(/[^\\/]+$/)[0];return t},notEmpty:function(e){var t=!!e&&!(0===e.length);return t},ico:function(e){return"True"===e||"Yes"===e?"check":"cross"}});var s=Handlebars.templates[o](n);a.$infoInner.innerHTML=s,e.notify({type:"app-updated",data:{message:""}}),t&&console.log("loaded")}function s(t){var a="resources/images/"+p+"/"+t;return e.get(a).then(function(e){return e}).catch(function(e){console.log(e)})}function c(t){var a="resources/other/"+p+"/"+t;return e.get(a).then(function(e){return e}).catch(function(e){console.log(e)})}function l(){var e=y.ukey;Promise.all([s(e),c(e)]).then(function(e){var t={miscImages:[],otherFiles:[]};e[0].data.forEach(function(e,a){/before.jpg/i.test(e)?t.beforeImage=e:/after.jpg/i.test(e)?t.afterImage=e:/main.jpg/i.test(e)?t.mainImage=e:0!==a&&t.miscImages.push(e)}),e[1].data.forEach(function(e,a){0!==a&&t.otherFiles.push(e)});var a=Object.assign(y,t);n[p][g]=a,o(a)}).catch(function(e){console.log(e),n[p][g]=r,o(r)}),m.showInfoWindow()}function u(){var e=y.ID;s(e).then(function(e){var t=r.activeProject.alldata.ImageData,a=/(\w*)(?:\.jpg)/i,i={images:[]};e.data.forEach(function(e,n){if(0!==n){var r=t.find(function(t){return t.PathNew===a.exec(e)[1]}).name;r&&i.images.push({image:e,caption:r})}}),Object.assign(y,i),n[p][g]=y,o(y),m.showInfoWindow()}).catch(function(e){console.log(e),n[p][g]=r,o(r),m.showInfoWindow()})}function d(){t&&console.log("fetch housing"),s(g).then(function(e){var t=/\w*(?:\.jpg)/i,a={images:[]};e.data.forEach(function(e,i){0!==i&&t.test(e)&&a.images.push(e)});var i=Object.assign(y,a);n[p][g]=i,o(Object.assign({},i.alldata[v],{images:i.images},{building:i.buildingName,study:"Unit No. "+(v+1)}))}).catch(function(e){console.log(e),o(Object.assign({},y.alldata[v],{building:y.buildingName,study:"Unit No. "+(v+1)}))}),m.showInfoWindow()}e.notify({type:"app-updating",data:{message:"Loading Project"}});var p=r.activeLayer,f=r.activeProject,v="housing"===p?r.activeProjectName-1:r.activeProjectName,y=void 0,g=void 0;"projects"===p?(y=f.f,g=y.OBJECTID):"buildings"===p?(y=f.alldata,g=y.ID):(y=f,g=y.getProperty("OBJECTID"));var m=this;if(a.$infoInner.scrollTop=0,a.$info.classList.remove("js-infoExpanded"),n[p][g])return e.notify({type:"app-updated",data:{message:""}}),o("housing"===p?Object.assign({},n[p][g].alldata[v],{images:n[p][g].images},{building:n[p][g].buildingName,study:"Unit No. "+(v+1)}):n[p][g]),this.showInfoWindow(),!0;switch(p){case"projects":l();break;case"buildings":u();break;case"housing":d()}},setupInfoWindow:function(){var t="map-info.tpl.hbs",i=Handlebars.templates[t]();e.injectTemplateText(i,a.$container),a.$infoGrabber=e.find(".map-info__grabber"),a.$infoInner=e.find(".map-info__inner"),a.$info=e.find(".map-info")},updateProject:function(e){this.updateInfoWindow(e)}}},WELFARE=function(e){var t=!1,a={activeLayer:null,previousLayer:null,previousProject:null,previousProjectName:"",activeProject:null,activeProjectName:"",activeProjectLatLang:null},i=function(){a.activeLayer=e.getHash(),e.notify({type:"init-layer-state",data:{previousLayer:a.previousLayer,activeLayer:a.activeLayer}})},n=function(){e.notify({type:"reset-map",data:{activeProject:a.activeProject,activeLayer:a.activeLayer}})},r=function(i){if(a.previousLayer=a.activeLayer,a.activeLayer=i,t){var n="<layer-update> Prev: "+a.previousLayer+" | Active: "+a.activeLayer;console.log(n)}e.notify({type:"reset-project",data:{activeProject:a.activeProject,activeLayer:a.activeLayer}}),e.notify({type:"layer-updated",data:{previousLayer:a.previousLayer,activeLayer:a.activeLayer}})},o=function(){e.notify({type:"update-project",data:{activeLayer:a.activeLayer,activeProject:a.activeProject,activeProjectName:a.activeProjectName,previousProject:a.previousProject,previousProjectName:a.previousProjectName,activeProjectLatLang:a.activeProjectLatLang}})},s=function(e){var i=void 0,n=void 0;switch(a.activeLayer){case"housing":i=e.data[a.activeLayer][e.category];break;case"buildings":n=e.category.replace(/-/g," - "),i=e.data[a.activeLayer].find(function(e){return e.name===n}).alldata[e.target];break;default:i=e.data[a.activeLayer][e.category][e.target]}t&&console.log(i);var r=i.getGeometry().getAt(0).getAt(0);a.previousProject=a.activeProject,a.previousProjectName=a.activeProjectName,a.activeProject=i,a.activeProjectLatLang=r,a.activeProjectName=e.target,o()},c=function(e){switch(a.previousProject=a.activeProject,a.previousProjectName=a.activeProjectName,a.activeProject=e.data.feature,a.activeProjectLatLang=e.data.latLng,a.activeLayer){case"projects":a.activeProjectName=a.activeProject.getProperty("RelatedEnglishTitle");break;case"buildings":a.activeProjectName=a.activeProject.alldata.BuildingName;break;case"housing":a.activeProjectName="1"}o()},l=function(){a.activeProject&&(e.notify({type:"reset-project",data:{activeProject:a.activeProject,activeLayer:a.activeLayer}}),t&&console.log("reset project and map"))};return{init:function(){i(),e.listen({"session-state-pop":r,"project-clicked":c,"project-nav-clicked":s,"category-closed":l,back2map:n})},destroy:function(){}}},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},MAP=function(e){var t=void 0,a={},i={layers:{},styles:{strokeWeight:2,strokeColor:"transparent",fillColor:"#e2cd57",fillOpacity:1},options:{center:{lat:31.777,lng:35.234},zoom:16,styles:mapStyles}};return{init:function(){var n=this;a.map=e.find("#map"),t=new google.maps.Map(a.map,i.options),console.log("https://elasticbeanstalk-us-west-2-759804563210.s3.amazonaws.com/welfare-rev/"),e.get("data/layers.json").then(function(e){n.setupLayers(e)}),this.updateMap=this.updateMap.bind(this),this.updateProject=this.updateProject.bind(this),this.resetProject=this.resetProject.bind(this),e.listen({"init-layer-state":this.updateMap,"layer-updated":this.updateMap,"update-project":this.updateProject,"reset-project":this.resetProject,"reset-map":this.resetProject})},destroy:function(){},setupLayers:function(a){Object.keys(a).forEach(function(e){var t={};t.dataLayer=new google.maps.Data,t.dataLayer.setStyle(i.styles),t.dataLoaded=!1,t.eventAdded=!1,t.visible=!1,i.layers[e]=Object.assign({},t,a[e])}),e.notify({type:"map-is-loaded",data:t}),e.notify({type:"app-updated",data:{message:"yo"}}),e.notify({type:"layers-created",data:i.layers})},disableLayer:function(e){if(e){var t=e;t.visible=!1,t.dataLayer.setMap(null)}},enableLayer:function(e){var a=e;a.visible=!0,a.dataLayer.setMap(t)},loadMap:function(t,a){var n=this,r=t?i.layers[t]:null,o=a?i.layers[a]:null;if(t&&t===a||a&&"/"!==a&&("/"===t||!t))return r&&r.visible?this.disableLayer(r):r?this.enableLayer(r):this.disableLayer(o),e.notify({type:"layers-data-updated",data:{active:r,previous:o}}),!0;if(!t||"/"===t&&!a)return!0;if(t&&i.layers[t]&&!i.layers[t].dataLoaded){var s=function(){e.notify({type:"app-updating",data:{message:"Loading "+t+" Layer"}});var i=function(e){var t=new Promise(function(t,a){try{r.dataLayer.loadGeoJson(e,{},function(e){t(e)})}catch(e){a(e)}});return t},s=function(i){r.data=i,r.dataLoaded=!0,n.enableLayer(r),a&&"/"!==a&&a!==t&&n.disableLayer(o),e.notify({type:"app-updated",data:{message:""}}),e.notify({type:"layers-data-updated",data:{active:r,previous:o}})};if("projects"===t){var c=r.url;i(c).then(function(e){s(e)}).catch(function(e){console.log(e)})}else!function(){var a=r.keysUrl,n=r.url,o=void 0;i(a).then(function(t){return o=t,e.get(n).then(function(e){return e}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)}).then(function(e){var a={},i=1;if("buildings"===t){var n=!0,r=!1,c=void 0;try{for(var l,u=e.MainTable[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var d=l.value,p=d[0].SERIAL_NO;a[p]=d[0]}}catch(e){r=!0,c=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw c}}var f=!0,v=!1,y=void 0;try{for(var g,m=o[Symbol.iterator]();!(f=(g=m.next()).done);f=!0){var h=g.value,b=h.getProperty("SERIAL_NO"),j={};a[b]&&(j.alldata=a[b],Object.assign(h,j))}}catch(e){v=!0,y=e}finally{try{!f&&m.return&&m.return()}finally{if(v)throw y}}}else{var L=!0,_=!1,P=void 0;try{for(var T,w=Object.keys(e)[Symbol.iterator]();!(L=(T=w.next()).done);L=!0){var E=T.value,N=e[E][0].SERIAL_NO;a[N]||(a[N]=[]),a[N].push(e[E][0])}}catch(e){_=!0,P=e}finally{try{!L&&w.return&&w.return()}finally{if(_)throw P}}var C=!0,k=!1,O=void 0;try{for(var A,I=o[Symbol.iterator]();!(C=(A=I.next()).done);C=!0){var S=A.value,x=S.getProperty("SERIAL_NO"),M={};a[x]&&(M.alldata=a[x],Object.assign(S,M,{buildingName:"Building No. "+i})),i+=1}}catch(e){k=!0,O=e}finally{try{!C&&I.return&&I.return()}finally{if(k)throw O}}}s(o)}).catch(function(e){console.log(e)})}();return r.eventAdded||(r.dataLayer.addListener("click",function(t){e.notify({type:"project-clicked",data:{data:t,active_layer:r}})}),r.eventAdded=!0),{v:!0}}();if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}return a&&"/"!==a&&a!==t&&this.disableLayer(o),this.enableLayer(r),e.notify({type:"layers-data-updated",data:{active:r,previous:o}}),!0},updateMap:function(e){var t=this;if(Object.keys(i.layers).length>0)return void this.loadMap(e.activeLayer,e.previousLayer);var a=void 0,n=setInterval(function(){a()},200);a=function(){Object.keys(i.layers).length>0&&(t.loadMap(e.activeLayer,e.previousLayer),clearInterval(n))}},resetProject:function(e){var a=e.activeProject,n=i.layers[e.activeLayer].dataLayer;n.overrideStyle(a,i.styles),t.panTo({lat:31.777,lng:35.234}),t.setZoom(16)},updateProject:function(e){var a=e.activeProject,n=e.previousProject,r=i.layers[e.activeLayer].dataLayer,o=e.activeProjectLatLang;n&&r.overrideStyle(n,i.styles),r.overrideStyle(a,{fillColor:"#BE4459",fillOpacity:1}),t.panTo(o),t.setZoom(18)}}},OVERLAY=function(e){return{init:function(){e.listen({"map-is-loaded":this.createOverlay})},destroy:function(){},createOverlay:function(e){function t(t){this.bounds=a,this.image=t,this.map=e,this.div=null,this.setMap(e)}var a=new google.maps.LatLngBounds(new google.maps.LatLng(31.77278,35.225652),new google.maps.LatLng(31.783742,35.237573)),i="../images/basemap.png";t.prototype=new google.maps.OverlayView,t.prototype.onAdd=function(){var e=document.createElement("div");e.style.borderStyle="none",e.style.borderWidth="0px",e.style.position="absolute";var t=document.createElement("img");t.src=this.image,t.style.width="100%",t.style.height="100%",t.style.position="absolute",e.appendChild(t),this.div=e;var a=this.getPanes();a.overlayLayer.appendChild(e)},t.prototype.draw=function(){var e=this.getProjection(),t=e.fromLatLngToDivPixel(this.bounds.getSouthWest()),a=e.fromLatLngToDivPixel(this.bounds.getNorthEast()),i=this.div;i.className="overlay",i.style.left=t.x+"px",i.style.top=a.y+"px",i.style.width=a.x-t.x+"px",i.style.height=t.y-a.y+"px"},t.prototype.onRemove=function(){this.div.parentNode.removeChild(this.div),this.div=null};new t(i)}}},MESSAGES=function(e){var t=e.find("#messages"),a=e.find(".message");return{init:function(){e.listen({"app-updating":this.showLoader,"app-updated":this.hideLoader})},showLoader:function(e){a.innerHTML=e.message,t.classList.add("js-active")},hideLoader:function(){a.innerHTML="",t.classList.remove("js-active")},destroy:function(){}}},NAV=function(e){var t={},a={},i={},n={activeCategory:null,activeProject:null,previousProject:null,activeLayer:null},r=!1;return{init:function(){t.$nav=e.find("#map__nav"),t.$info=e.find(".map-info"),this.onNavClick=this.onNavClick.bind(this),this.setMainNav=this.setMainNav.bind(this),this.updateMainNav=this.updateMainNav.bind(this),this.updateProject=this.updateProject.bind(this),this.resetProject=this.resetProject.bind(this),this.onMapReset=this.onMapReset.bind(this),e.listen({"layers-created":this.setMainNav,"layers-data-updated":this.updateMainNav,"update-project":this.updateProject,"reset-project":this.resetProject,"reset-map":this.onMapReset}),t.$nav.addEventListener("click",this.onNavClick,!1)},onMapReset:function(e){this.resetProject(e),this.resetNav(e)},updateMainNav:function(i){var r=i.active&&i.active.data,o=i.active&&i.active.name,s=i.previous&&i.previous.name,c=o&&a[o].populated;return n.activeLayer=o,!o&&s?(e.find(".map__nav__item-wrapper--"+s).classList.remove("js-active"),t.$nav.classList.remove("js-layerIsOpened"),this.resetNav(),!0):(!c&&r&&(this.setLayerNav(r,o),a[o].populated=!0),s&&(e.find(".map__nav__item-wrapper--"+s).classList.remove("js-active"),t.$nav.classList.remove("js-layerIsOpened",""+o,""+s),this.resetNav()),(o!==s||o===s&&i.active.visible)&&(e.find(".map__nav__item-wrapper--"+o).classList.add("js-active"),t.$nav.classList.add("js-layerIsOpened",""+o)),!0)},resetNav:function(){n.activeCategory&&this.closeCategory(n.activeCategory,n.activeCategory.nextElementSibling)},setMainNav:function(i){var n=this,r=Handlebars.templates["nav.tpl.hbs"](i);e.injectTemplateText(r,t.$nav),t.navItemWrapper=e.findAll(".map__nav__item-wrapper"),t.navItem=e.findAll(".map__nav__item--layer"),t.$about=e.findAll(".about-btn"),Object.keys(i).forEach(function(e){var t={};t.populate=!1,t.parentEL=document.querySelector(".map__nav__item--"+e),t.data=null,a[e]=t}),t.$about.forEach(function(e){e.addEventListener("click",n.onAboutClick)})},buildProjectsLayerNavigation:function(t,a,n){var o=function(t,a){var i=e.createElement("div",{class:["map__nav__item--category","map__nav__item--category--"+t]}),n=e.createElement("div",{class:["category__inner"]}),o=Handlebars.templates["nav-cat.tpl.hbs"]({title:t});return e.injectTemplateText(o,i),i.appendChild(n),Object.keys(a).forEach(function(i){var o=a[i].getProperty("RelatedEnglishTitle");if(a[i].getGeometry().getAt(0)){var s=Handlebars.templates["nav-layer-wcat.tpl.hbs"]({title:o,cat:t});e.injectTemplateText(s,n)}else r&&console.log(o+" does not have geometry")}),i};if(!i[n]){var s={},c=!0,l=!1,u=void 0;try{for(var d,p=a[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value,v=f.getProperty("CatAName"),y=f.getProperty("RelatedEnglishTitle");s[v]||(s[v]={}),s[v][y]||(s[v][y]=f)}}catch(e){l=!0,u=e}finally{try{!c&&p.return&&p.return()}finally{if(l)throw u}}i[n]=s}Object.keys(i[n]).forEach(function(e){var a=o(e,i[n][e]);t.appendChild(a)}),e.find(".map__nav__item-wrapper--"+n).appendChild(t)},buildBuildingsLayerNavigation:function(t,a,n){var o=function(t,a){var i=e.createElement("div",{class:["map__nav__item--category","map__nav__item--category--"+t]}),n=e.createElement("div",{class:["category__inner"]}),o=Handlebars.templates["nav-cat-noicon.tpl.hbs"]({title:t});return e.injectTemplateText(o,i),i.appendChild(n),Object.keys(a).forEach(function(i){var o=a[i].alldata.BuildingName;if(a[i].getGeometry()&&a[i].getGeometry().getAt(0)){var s=Handlebars.templates["nav-layer-wcat.tpl.hbs"]({title:o,cat:t});e.injectTemplateText(s,n)}else r&&console.log(o+" does not have geometry")}),i};i[n]||!function(){var r={},s=[],c=void 0;e.get("data/sort.json").then(function(l){c=l.Sort,c.forEach(function(e){e.sort=parseInt(e.sort,10)});var u=!0,d=!1,p=void 0;try{for(var f,v=function(){var e=f.value,t=e.alldata.BuildingType,a=e.alldata.BuildingName.trim();r[t]||(r[t]={},r[t].name=t,r[t].sort=c.find(function(e){return e.Name===t}).sort),r[t].alldata||(r[t].alldata={}),r[t].alldata[a]||(r[t].alldata[a]=e)},y=a[Symbol.iterator]();!(u=(f=y.next()).done);u=!0)v()}catch(e){d=!0,p=e}finally{try{!u&&y.return&&y.return()}finally{if(d)throw p}}Object.keys(r).forEach(function(e){s.push(r[e])}),s=_.sortBy(s,"sort"),i[n]=s,i[n].forEach(function(e){var a=e.name.replace(/ +/g,""),i=o(a,e.alldata);t.appendChild(i)}),e.find(".map__nav__item-wrapper--"+n).appendChild(t)})}()},buildHousingLayerNavigation:function(t,a,n){var r=function(t,a){var i=e.createElement("div",{class:["map__nav__item--category","map__nav__item--category--"+t]}),n=e.createElement("div",{class:["category__inner"]}),r=Handlebars.templates["nav-cat-noicon.tpl.hbs"]({title:a.buildingName});return e.injectTemplateText(r,i),i.appendChild(n),a.alldata.forEach(function(a,i){var r="Unit No."+(i+1),o=Handlebars.templates["nav-layer-housing.tpl.hbs"]({target:i+1,title:r,cat:t});e.injectTemplateText(o,n)}),i};if(!i[n]){var o={},s=!0,c=!1,l=void 0;try{for(var u,d=a[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var p=u.value,f=p.buildingName.replace(/ +/g,"").replace(/\./g,"-");o[f]||(o[f]=p)}}catch(e){c=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw l}}i[n]=o}Object.keys(i[n]).forEach(function(e){var a=r(e,i[n][e]);t.appendChild(a)}),e.find(".map__nav__item-wrapper--"+n).appendChild(t)},setLayerNav:function(t,a){var i=e.createElement("div",{class:["map__nav__item__inner"]});switch(a){case"projects":this.buildProjectsLayerNavigation(i,t,a);break;case"buildings":this.buildBuildingsLayerNavigation(i,t,a);break;case"housing":this.buildHousingLayerNavigation(i,t,a);break;default:return!0}},resetProject:function(t){if(!t.activeProject)return!0;var a=void 0;switch(t.activeLayer){case"projects":a=t.activeProject.getProperty("RelatedEnglishTitle")||void 0;break;case"buildings":a=t.activeProject.getProperty("BuildingNa")||void 0;break;case"housing":}return a&&e.find('[data-target="'+a+'"]').classList.remove("js-active"),!0},onProjectClick:function(t){e.notify({type:"project-nav-clicked",data:{category:t.dataset.cat,target:t.dataset.target,data:i}})},updateProject:function(a){var i=a.activeLayer,n={},r=void 0,o=void 0,s=void 0,c=void 0;if("housing"!==i)a.previousProjectName&&(r=e.find('[data-target="'+a.previousProjectName+'"]'),n.prevProjCat=e.find(".map__nav__item--category--"+r.dataset.cat),n.prevCatInner=n.prevProjCat.querySelector(".category__inner"),r.classList.remove("js-active")),o=e.find('[data-target="'+a.activeProjectName+'"]'),s=e.find(".map__nav__item--category--"+o.dataset.cat),c=s.querySelector(".category__inner"),o.classList.add("js-active"),t.$nav.classList.add("js-layerIsOpened"),n.activeProj=o,this.toggleCategory(s,c,!0,n);else{if(a.previousProjectName){var l=a.previousProject.buildingName.replace(/ +/g,"").replace(/\./g,"-");r=e.find('[data-target="'+a.previousProjectName+'"][data-cat="'+l+'"]'),n.prevProjCat=e.find(".map__nav__item--category--"+l),n.prevCatInner=n.prevProjCat.querySelector(".category__inner"),r.classList.remove("js-active")}var u=a.activeProject.buildingName.replace(/ +/g,"").replace(/\./g,"-");o=e.find('[data-target="'+a.activeProjectName+'"][data-cat="'+u+'"]'),s=e.find(".map__nav__item--category--"+u),c=s.querySelector(".category__inner"),o.classList.add("js-active"),t.$nav.classList.add("js-layerIsOpened"),n.activeProj=o,this.toggleCategory(s,c,!0,n)}},adjustProjectInnerPosition:function(e,t,a,i){var r=e,o=i,s=0,c=0,l=t+3;"projects"===n.activeLayer?(s=(t+3-a)*-1,c=s*-1-150):"buildings"===n.activeLayer?(s=(t+3-a)*-1,c=s*-1+300,l=t+3):(s=(t+3-a)*-1,c=s*-1+450,l=t+3+450),r.parentNode.scrollLeft=0;var u=function(){return new Promise(function(e,t){try{setTimeout(function(){r.parentNode.style.transform="translate3d("+s+"px, 0, 0)",e()},200)}catch(e){t(e)}})},d=function(){return new Promise(function(e,t){try{setTimeout(function(){r.parentNode.style.width="calc(100% + "+c+"px)",e()},300)}catch(e){t(e)}})};u().then(function(){d().then(function(){o.style.width="calc(100% - "+l+"px)"}).catch(function(e){console.log("adjusting width error: "+e)})}).catch(function(e){console.log("adjusting position error: "+e)})},resetProjectInnerPosition:function(e,t){var a=e,i=t;i.scrollLeft=0,a.parentNode.removeAttribute("style"),i.removeAttribute("style")},closeCategory:function(a,i,r){var o=a||n.activeCategory;o&&(o&&i&&this.resetProjectInnerPosition(o,i),o.classList.remove("js-active"),t.$nav.classList.remove("js-catIsOpened"),r||e.notify({type:"category-closed",data:{fromMap:r}}))},openCategory:function(e,a){var i=e||n.activeCategory;t.$nav.scrollLeft>0&&(t.$nav.scrollLeft=0);var r=i.offsetLeft,o=i.offsetWidth;i.classList.add("js-active"),t.$nav.classList.add("js-catIsOpened"),this.adjustProjectInnerPosition(i,r,o,a)},toggleCategory:function(e,a,i,r){var o=a;return i?(n.activeCategory&&e!==n.activeCategory&&r.prevProjCat&&this.closeCategory(r.prevProjCat,r.prevCatInner,i),e.classList.contains("js-active")||this.openCategory(e,a),n.activeCategory=e,setTimeout(function(){o.scrollLeft=r.activeProj.offsetLeft-r.activeProj.offsetWidth},10),!0):n.activeCategory&&n.activeCategory===e?(e.classList.contains("js-active")?this.closeCategory(e,a):this.openCategory(e,a),!0):(n.activeCategory&&(n.activeCategory.classList.remove("js-active"),t.$nav.classList.remove("js-catIsOpened")),n.activeCategory=e,this.openCategory(e,a),!0)},onNavClick:function(e){var t=void 0,a=void 0,i=e.target.classList;return e.currentTarget!==e.target&&(i.contains("map__nav__item--project")?(t=e.target,this.onProjectClick(t)):i.contains("category-wrapper")?(t=e.target.parentNode,a=e.target.nextElementSibling,this.toggleCategory(t,a)):i.contains("map__nav__item__icon")||i.contains("map__nav__item__name")?(t=e.target.parentNode.parentNode,t.classList.contains("map__nav__item--category")&&(a=e.target.parentNode.nextElementSibling,this.toggleCategory(t,a))):i.contains("map__nav__item__title")&&(t=e.target.parentNode,this.onProjectClick(t))),e.stopPropagation(),!0},onAboutClick:function(t){e.notify({type:"about-clicked",data:t.target.dataset.target})}}};